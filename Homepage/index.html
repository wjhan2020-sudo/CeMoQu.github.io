<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CeMoQu – Ataxia Diagnostic Suite</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#020617;
      --panel:#02091b;
      --panel-soft:#020b21;
      --accent:#203fdb;
      --accent-soft:rgba(16,185,129,0.16);
      --muted:#94a3b8;
      --muted-soft:#1f2937;
      --text:#e5e7eb;
      --danger:#ef4444;
    }
    *{box-sizing:border-box;}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:radial-gradient(circle at top,#020b21 0,#020617 45%,#000 100%);color:var(--text);}
    body{display:flex;justify-content:center;padding:16px;align-items:flex-start;min-height:100vh;overflow-y:auto;}
    .shell{width:100%;max-width:1024px;border-radius:24px;background:linear-gradient(145deg,rgba(15,23,42,0.96),rgba(15,23,42,0.92));border:1px solid #111827;padding:20px 20px 22px;box-shadow:0 24px 80px rgba(0,0,0,0.7);}
    header{display:flex;justify-content:space-between;align-items:flex-start;gap:16px;flex-wrap:wrap;margin-bottom:20px;}
    .title-block h1{margin:0;font-size:24px;letter-spacing:0.02em;}
    .title-block p{margin:6px 0 0;font-size:14px;color:var(--muted);}
    .tag-pill{border-radius:999px;padding:6px 10px;font-size:11px;border:1px solid rgba(148,163,184,0.4);color:var(--muted);display:inline-flex;align-items:center;gap:6px;white-space:nowrap;}
    .tag-pill span.led{width:8px;height:8px;border-radius:999px;background:var(--accent);box-shadow:0 0 10px rgba(16, 185, 174, 0.7);}
    main{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:16px;}
    @media(max-width:900px){main{grid-template-columns:repeat(2,minmax(0,1fr));}}
    @media(max-width:640px){main{grid-template-columns:minmax(0,1fr);}}
    /* ---------------- GLOBAL HEADER ---------------- */
    .global-header {position: fixed;top: 0;left: 0;width: 100%;height: 54px;padding: 0 24px;display: flex;justify-content: space-between;align-items: center;background: rgba(3, 7, 20, 0.72);backdrop-filter: blur(12px);border-bottom: 1px solid rgba(148, 163, 184, 0.18);z-index: 2000;}
    .gh-left {display: flex;align-items: center;gap: 12px;}
    .gh-logo {font-size: 20px; font-weight: 700;color: var(--text);}
    .gh-version {font-size: 12px;padding: 2px 6px;border-radius: 6px;background: rgba(148,163,184,0.10);color: var(--muted);}
    .gh-nav {display: flex;gap: 24px;}
    .gh-nav a {color: var(--muted);text-decoration: none;font-size: 14px;transition: color .15s ease;}
    .gh-nav a:hover {color: var(--text);}
    body {padding-top: 70px;}
    
    .card{
      position:relative;
      border-radius:18px;
      padding:16px 14px 14px;
      background:radial-gradient(circle at top left,rgba(15,23,42,0.95),var(--panel-soft));
      border:1px solid rgba(30,64,175,0.35);
      box-shadow:0 18px 45px rgba(15,23,42,0.9);
      display:flex;
      flex-direction:column;
      gap:10px;
      min-height:160px;
      overflow:hidden;
    }
    .card::before{
      content:"";
      position:absolute;
      inset:-80%;
      background:radial-gradient(circle at 0 0,rgba(56,189,248,0.08),transparent 55%);
      opacity:0.9;
      pointer-events:none;
    }
    .card h2{margin:0;font-size:16px;}
    .badge{display:inline-flex;align-items:center;gap:6px;font-size:11px;padding:3px 8px;border-radius:999px;background:rgba(15,23,42,0.9);border:1px solid rgba(148,163,184,0.35);color:var(--muted);}
    .badge-dot{width:7px;height:7px;border-radius:999px;background:var(--accent);}
    .card p{margin:0;font-size:13px;color:var(--muted);line-height:1.4;}
    .meta-row{display:flex;justify-content:space-between;align-items:center;margin-top:auto;margin-bottom:6px;font-size:11px;color:var(--muted);}
    .chip{padding:3px 8px;border-radius:999px;background:rgba(15,23,42,0.9);border:1px solid rgba(31,41,55,0.9);}
    a.test-link{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:6px;
      padding:8px 10px;
      border-radius:999px;
      border:0;
      outline:none;
      cursor:pointer;
      font-size:13px;
      font-weight:600;
      text-decoration:none;
      background:linear-gradient(135deg,var(--accent),#21c1fb);
      color:#052012;
      transition:transform 0.08s ease,box-shadow 0.08s ease,filter 0.08s ease;
      white-space:nowrap;
    }
    a.test-link:hover{transform:translateY(-1px);filter:brightness(1.03);}
    footer{margin-top:16px;display:flex;justify-content:space-between;align-items:center;gap:12px;font-size:11px;color:var(--muted);}
    footer .left{display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
    footer .dot{width:4px;height:4px;border-radius:999px;background:rgba(148,163,184,0.7);}

    /* --- Participant Metadata styles (match card) --- */
    .metadata-card { padding: 14px; border-radius: 14px; }
    .metadata-form {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px 12px;
      align-items: start;
    }
    @media(max-width:640px){
      .metadata-form { grid-template-columns: 1fr; }
    }
    .form-row { display:flex; flex-direction:column; gap:6px; }
    label { font-size:13px; color:var(--muted); }
    input[type="text"], input[type="number"], select, textarea {
      background: rgba(10,12,20,0.6);
      border:1px solid rgba(148,163,184,0.08);
      color:var(--text);
      padding:10px 12px;
      border-radius:10px;
      outline: none;
      font-size:14px;
      min-height:36px;
    }
    input[readonly] { opacity:0.85; background:rgba(10,12,20,0.35); }
    textarea { min-height:84px; resize:vertical; padding-top:10px; }
    .muted-hint { font-size:12px; color:var(--muted); }
    .form-actions { display:flex; gap:10px; align-items:center; margin-top:6px; }
    .btn {
      padding:8px 12px; border-radius:10px; font-weight:600; cursor:pointer;
      background: linear-gradient(135deg,var(--accent),#21c1fb); color:#052012; border:none;
      box-shadow:none; outline:none;
    }
    .btn.ghost {
      background:transparent; border:1px solid rgba(148,163,184,0.12); color:var(--muted); font-weight:600;
    }
    .small-note { font-size:12px; color:var(--muted); margin-left:auto; }
    /* keep form visually light */
    .field-grid { display:flex; gap:8px; }
    .field-grid > * { flex:1; }
  </style>
</head>
<body>
    <nav class="global-header">
        <div class="gh-left">
            <span class="gh-logo">CeMoQu</span>
            <span class="gh-version">v0.1</span>
        </div>

        <div class="gh-nav">
            <a href="index2.html">Home</a>
            <a href="past_results/index.html">Past Results</a>
            <a href="help/index.html">Help</a>
        </div>
    </nav>
  <div class="shell">
    <header>
      <div class="title-block">
        <h1>CeMoQu · Cerebral Motion Quantitative </h1>
        <p>Select a test to launch. </p>
      </div>
      <div class="tag-pill">
        <span class="led"></span>
        Homepage
      </div>
    </header>

    <main>
      <!-- Card 1: Speech Disturbance / Reading -->
      <section class="card">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:8px;">
          <div>
            <h2>Speech Disturbance Test</h2>
            <div class="badge"><span class="badge-dot"></span> SARA-4 compatible</div>
          </div>
        </div>
        <p>
          Guided 5-sentence reading task that records audio, tracks loudness and pitch stability,
          and maps variability to a 0–6 stability score.
        </p>
        <div class="meta-row">
          <div class="chip">Input: Microphone</div>
          <a class="test-link" href="../SD/index.html">
            Open Speech Test
          </a>
        </div>
      </section>

      <!-- Card 2: Random Target Touch -->
      <section class="card">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:8px;">
          <div>
            <h2>Random Target Touch Test</h2>
            <div class="badge"><span class="badge-dot"></span> Cursor &amp; Camera modes</div>
          </div>
        </div>
        <p>
          Point-to-target task for upper-limb control. Measures error distance, tremor, smoothness,
          and time-in-target; exports trial-by-trial metrics to CSV.
        </p>
        <div class="meta-row">
          <div class="chip">Input: Mouse / Finger Tracking</div>
          <a class="test-link" href="../RT/index.html">
            Open Target Test
          </a>
        </div>
      </section>

      <!-- Card 3: Line Drawing Test -->
      <section class="card">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:8px;">
          <div>
            <h2>Line Drawing Test</h2>
            <div class="badge"><span class="badge-dot"></span> CeMoQu Line Task</div>
          </div>
        </div>
        <p>
          Start–finish line tracing (horizontal, vertical, diagonal). Tracks deviation, turns,
          off-line segments, and maps them to a SARA-style subscore.
        </p>
        <div class="meta-row">
          <div class="chip">Input: Mouse / Touch</div>
          <a class="test-link" href="../LD/index.html">
            Open Line Test
          </a>
        </div>
      </section>
    </main>

    <!-- Participant Metadata Input Panel (new) -->
    <section class="card metadata-card" aria-labelledby="metadata-title" style="margin-top:14px;">
      <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:8px;">
        <div>
          <h2 id="metadata-title">Participant Metadata Input Panel</h2>
          <div class="badge"><span class="badge-dot"></span> Local Metadata</div>
        </div>
      </div>

      <form id="metadata-form" class="metadata-form" onsubmit="return false;" aria-describedby="metadata-note">
        <div class="form-row">
          <label for="participant-id">Participant ID / Name</label>
          <input id="participant-id" name="participantId" type="text" placeholder="e.g., P-001 or Jane Doe" />
        </div>

        <div class="form-row">
          <label for="session-id">Session ID <span class="muted-hint">(auto-generated)</span></label>
          <input id="session-id" name="sessionId" type="text" readonly />
        </div>

        <div class="form-row">
          <label for="age">Age</label>
          <input id="age" name="age" type="number" min="0" max="120" placeholder="years" />
        </div>

        <div class="form-row">
          <label for="gender">Gender</label>
          <select id="gender" name="gender">
            <option value="" selected>Prefer not to answer</option>
            <option value="female">Female</option>
            <option value="male">Male</option>
            <option value="nonbinary">Non-binary</option>
            <option value="other">Other</option>
          </select>
        </div>

        <div class="form-row">
          <label for="dominant-hand">Dominant Hand <span class="muted-hint">(optional — used by Random Target Touch Test)</span></label>
          <div id="dominant-hand" class="field-grid" aria-describedby="dominant-hand-hint">
            <select name="dominantHand">
              <option value="">(not specified)</option>
              <option value="right">Right</option>
              <option value="left">Left</option>
              <option value="ambidextrous">Ambidextrous</option>
            </select>
          </div>
        </div>

        <div class="form-row" style="grid-column: 1 / -1;">
          <label for="notes">Notes (clinician)</label>
          <textarea id="notes" name="notes" placeholder="Clinician notes, conditions, reminders..."></textarea>
        </div>

        <div class="form-row" style="grid-column: 1 / -1;">
          <div class="form-actions">
            <button id="save-btn" class="btn" type="button">Save Locally (Download JSON)</button>
            <button id="clear-btn" class="btn ghost" type="button">Clear</button>
            <div class="small-note" id="metadata-note">This information is stored locally and is included in exported CSVs.</div>
          </div>
        </div>
      </form>
    </section>

    <footer>
        <div class="left">
            <span>Local processing only. No data is uploaded.</span>
            <span class="dot"></span>
            <a href="https://github.com/voc2018/CeMoQu" target="_blank" rel="noopener" style="color: var(--muted); text-decoration: none;">
            Documentation link
            </a>
            <span class="dot"></span>
            <a href="https://github.com/voc2018/CeMoQu" target="_blank" rel="noopener" style="color: var(--muted); text-decoration: none;">
            Contact link
            </a>
        </div>

        <div>CeMoQu · v0.1</div>
    </footer>

  <script>
    (function(){
      // Simple session id generator: ISO timestamp + random 4-char hex
      function generateSessionId(){
        const ts = new Date().toISOString().replace(/[:.]/g,'-');
        const rand = Math.floor(Math.random()*0xFFFF).toString(16).padStart(4,'0');
        return 'S-'+ts+'-'+rand;
      }

      const sessionField = document.getElementById('session-id');
      if(sessionField){
        sessionField.value = generateSessionId();
      }

      // Save locally button -> creates a JSON file and triggers download
      const saveBtn = document.getElementById('save-btn');
      const clearBtn = document.getElementById('clear-btn');

      function collectFormData(){
        const fm = document.getElementById('metadata-form');
        const data = {
          participantId: fm.participantId.value || '',
          sessionId: fm.sessionId.value || '',
          age: fm.age.value || '',
          gender: fm.gender.value || '',
          dominantHand: fm.dominantHand ? fm.dominantHand.value : '',
          notes: fm.notes.value || '',
          savedAt: new Date().toISOString()
        };
        return data;
      }

      function downloadObjectAsJson(obj, filename){
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(obj, null, 2));
        const dlAnchor = document.createElement('a');
        dlAnchor.setAttribute("href", dataStr);
        dlAnchor.setAttribute("download", filename);
        document.body.appendChild(dlAnchor);
        dlAnchor.click();
        dlAnchor.remove();
      }

      if(saveBtn){
        saveBtn.addEventListener('click', function(){
          const data = collectFormData();
          const filename = (data.participantId ? data.participantId : 'participant') + '_' + (data.sessionId ? data.sessionId : 'session') + '.json';
          downloadObjectAsJson(data, filename);
        });
      }

      if(clearBtn){
        clearBtn.addEventListener('click', function(){
          const fm = document.getElementById('metadata-form');
          fm.reset();
          // regenerate session id after clearing
          if(sessionField) sessionField.value = generateSessionId();
        });
      }

      // Optional: If you later want to hide dominant-hand unless RT test selected,
      // you can add event listeners to test links and set a flag. For now leave visible but optional.
    })();
  </script>
</body>
</html>
